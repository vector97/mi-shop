(()=>{"use strict";const e=e=>{const t=document.createElement("div");t.classList.add("modal-backdrop"),t.classList.add("fade"),document.body.append(t),e.classList.add("d-block"),setTimeout((()=>{t.classList.add("show"),e.classList.add("show")}),1)},t=e=>{const t=document.querySelector(".modal-backdrop");e.classList.remove("show"),t&&t.classList.remove("show"),setTimeout((()=>{e.classList.remove("d-block"),t&&t.remove()}),300)},n="http://localhost:3001",o=e=>fetch(n+e).then((e=>{if(!e.ok)throw new Error;return e.json()}));(()=>{const n=document.getElementById("open-auth-btn"),c=document.getElementById("open-cart-btn"),r=document.getElementById("logout-btn"),s=document.getElementById("open-admin-btn"),a=document.getElementById("auth-modal"),d=a.querySelector("#login-control"),l=a.querySelector("#password-control"),i=a.querySelector(".login-btn"),m=a.querySelectorAll(".close-btn");l.type="password";const u=()=>{n.classList.add("d-none"),c.classList.remove("d-none"),r.classList.remove("d-none"),s.classList.remove("d-none"),t(a)};n.addEventListener("click",(()=>{e(a)})),m.forEach((e=>{e.addEventListener("click",(()=>{t(a)}))})),i.addEventListener("click",(()=>{const e=d.value,t=l.value,n='<p class="login__error" style="color: red;">Неверный логин</p>',c='<p class="password__error" style="color: red;">Неверный пароль</p>';o("/profile").then((o=>{const r=document.querySelector(".login__error"),s=document.querySelector(".password__error"),a=o.login&&o.login===e,i=o.password&&o.password===t;a&&i?(r&&r.remove(),s&&s.remove(),localStorage.setItem("auth",JSON.stringify(o)),u()):a||i?!a&&i?(!r&&d.insertAdjacentHTML("afterend",n),s&&s.remove()):a&&!i?(!s&&l.insertAdjacentHTML("afterend",c),r&&r.remove()):alert("Введите данные от аккаунта"):(!r&&d.insertAdjacentHTML("afterend",n),!s&&l.insertAdjacentHTML("afterend",c))}))})),r.addEventListener("click",(()=>{localStorage.removeItem("auth"),n.classList.remove("d-none"),c.classList.add("d-none"),r.classList.add("d-none"),s.classList.add("d-none")})),(()=>{const e=JSON.parse(localStorage.getItem("auth"));e&&o("/profile").then((t=>{t.login&&t.login===e.login&&t.password&&t.password===e.password&&u()}))})()})(),(()=>{const e=document.getElementById("categories-container"),t=document.querySelector(".catalog-search"),n=t=>{e.innerHTML="",t.forEach((({id:t,name:n,preview:o})=>{e.insertAdjacentHTML("beforeend",`\n        <div class="col col-12 col-md-6 col-lg-4 mb-3">\n          <a href="/catalog.html?id=${t}" class="card-link">\n            <div class="card">\n              <img src="${o}" class="card-img-top" alt="phones">\n              <div class="card-body">\n                <h5 class="card-title">${n}</h5>\n              </div>\n            </div>\n          </a>\n        </div>\n      `)}))};t.addEventListener("input",(e=>{const t=e.target;o(`/categories?q=${t.value}`).then((e=>{n(e)})).catch((e=>{console.error("Произошла ошибка")}))})),o("/categories").then((e=>{n(e)})).catch((e=>{console.error("Произошла ошибка")}))})(),(()=>{const c=document.getElementById("cart-container"),r=document.getElementById("open-cart-btn"),s=document.getElementById("cart-modal"),a=document.getElementById("cart-total-price"),d=s.querySelectorAll(".close-btn"),l=()=>{o("/cart").then((e=>{(e=>{c.innerHTML="",e.forEach((e=>{const t=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB"}).format(e.price);c.insertAdjacentHTML("beforeend",`\n        <div class="row border-bottom pb-3 pt-3">\n          <div class="col col-12 col-md-6 mb-3 mb-md-0 fs-4">\n            ${e.name}\n          </div>\n          <div class="col col-12 col-md-6 fs-4 d-flex align-items-center justify-content-end flex-wrap">\n            <h4 class="me-3 d-flex align-itemns-center">${t}</h4>\n            <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls" id="control-dec" data-id="${e.id}" data-count="${e.count}">\n              -\n            </button>\n            <h6 class="cart-item-count me-3 ms-3">${e.count}</h6>\n            <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls" id="control-inc" data-id="${e.id}" data-name="${e.name}" data-price="${e.price}" data-count="${e.count}">\n              +\n            </button>\n          </div>\n        </div>\n      `)}))})(e),i(e)})).catch((e=>{console.error("Произошла ошибка")}))},i=e=>{let t=0;e.forEach((e=>{t+=Number(e.price)*e.count}));const n=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB"}).format(t);a.textContent=`${n}`};r.addEventListener("click",(()=>{l(),e(s)})),d.forEach((e=>{e.addEventListener("click",(()=>{t(s)}))})),c.addEventListener("click",(e=>{const t=e.target;if(t.closest("button"))if(t.id&&"control-inc"===t.id){const e=t.dataset.id;(o=`/cart/${e}`,c={id:e,name:t.dataset.name,count:Number(t.dataset.count)+1,price:t.dataset.price},fetch(n+o,{method:"PUT",body:JSON.stringify(c),headers:{"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error;return e.json()}))).then((()=>{l()}))}else if(t.id&&"control-dec"===t.id){const e=t.dataset.id,o=Number(t.dataset.count);o>0&&((e,t)=>fetch(n+e,{method:"PATCH",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error;return e.json()})))(`/cart/${e}`,{count:o-1}).then((()=>{l()}))}var o,c}))})()})();