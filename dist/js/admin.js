(()=>{"use strict";const e="http://localhost:3001",t=t=>fetch(e+t).then((e=>{if(!e.ok)throw new Error;return e.json()})),n=(t,n)=>fetch(e+t,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((e=>{if(!e.ok)throw new Error;return e.json()})),a=t=>fetch(e+t,{method:"DELETE"}).then((e=>{if(!e.ok)throw new Error;return e.json()}));(()=>{const e=document.getElementById("category-name"),d=document.getElementById("category-image"),r=document.getElementById("category-add-btn"),o=document.getElementById("category-container"),c=document.getElementById("product-category"),i={name:"",preview:""},u=()=>{""===e.value||""===d.value?r.disabled=!0:r.disabled=!1},l=()=>{t("/categories").then((e=>{(e=>{o.innerHTML="",c.innerHTML='\n      <option value="default" selected>Выберите категорию</option>\n    ',e.forEach(((e,t)=>{o.insertAdjacentHTML("beforeend",`\n        <tr>\n          <th scope="row">${t+1}</th>\n          <td>${e.name}</td>\n          <td class="text-end">\n            <button type="button" class="btn btn-outline-danger btn-sm" data-category="${e.id}">\n              удалить\n            </button>\n          </td>\n        </tr>\n      `),c.insertAdjacentHTML("beforeend",`\n        <option value="${e.id}">${e.name}</option>\n      `)}))})(e)}))};e.addEventListener("input",(()=>{i.name=e.value,u()})),d.addEventListener("input",(()=>{const e=d.files[0];if("image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type){const t=new FileReader;t.onload=()=>{i.preview=t.result},t.onerror=()=>{i.preview="",d.value=""},t.readAsDataURL(e)}else d.value="";u()})),r.addEventListener("click",(()=>{n("/categories",i).then((()=>{e.value="",d.value="",l()}))})),o.addEventListener("click",(e=>{const t=e.target;if("BUTTON"===t.tagName){const e=t.dataset.category;a(`/categories/${e}`).then((e=>{l()}))}})),l(),u()})(),(()=>{const e=document.getElementById("product-category"),d=document.getElementById("product-title"),r=document.getElementById("product-name"),o=document.getElementById("product-price"),c=document.getElementById("product-image"),i=document.getElementById("product-add-btn"),u=document.getElementById("product-table"),l={title:"",name:"",price:0,preview:"",category:0},s=e=>{u.innerHTML="",e.forEach(((e,t)=>{const n=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB"}).format(e.price);u.insertAdjacentHTML("beforeend",`\n        <tr>\n          <th scope="row">${t+1}</th>\n          <td>${e.title}</td>\n          <td>${e.name}</td>\n          <td>${n}</td>\n          <td class="text-end">\n            <button type="button" class="btn btn-outline-danger btn-sm" data-product="${e.id}">\n              удалить\n            </button>\n          </td>\n        </tr>\n      `)}))},p=()=>{"default"===e.value||""===d.value||""===r.value||0===Number(o.value)||""===c.value?i.disabled=!0:i.disabled=!1},m=()=>{t("/products").then((e=>{s(e)}))};e.addEventListener("change",(()=>{l.category=e.value;const n="default"!==e.value?`/products?category=${e.value}`:"/products";t(n).then((e=>{s(e)})),p()})),d.addEventListener("input",(()=>{l.title=d.value,p()})),r.addEventListener("input",(()=>{l.name=r.value,p()})),o.addEventListener("input",(()=>{l.price=Number(o.value),p()})),c.addEventListener("input",(()=>{const e=c.files[0];if("image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type){const t=new FileReader;t.onload=()=>{l.preview=t.result},t.onerror=()=>{l.preview="",c.value=""},t.readAsDataURL(e)}else c.value="";p()})),i.addEventListener("click",(()=>{n("/products",l).then((()=>{d.value="",r.value="",o.value=0,c.value="",m()}))})),u.addEventListener("click",(e=>{const t=e.target;if("BUTTON"===t.tagName){const e=t.dataset.product;a(`/products/${e}`).then((e=>{m()}))}})),m(),p()})()})();