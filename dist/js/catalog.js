(()=>{"use strict";const t=t=>{const e=document.createElement("div");e.classList.add("modal-backdrop"),e.classList.add("fade"),document.body.append(e),t.classList.add("d-block"),setTimeout((()=>{e.classList.add("show"),t.classList.add("show")}),1)},e=t=>{const e=document.querySelector(".modal-backdrop");t.classList.remove("show"),e&&e.classList.remove("show"),setTimeout((()=>{t.classList.remove("d-block"),e&&e.remove()}),300)},n="http://localhost:3001",o=t=>fetch(n+t).then((t=>{if(!t.ok)throw new Error;return t.json()}));(()=>{const n=document.getElementById("open-auth-btn"),c=document.getElementById("open-cart-btn"),r=document.getElementById("logout-btn"),s=document.getElementById("open-admin-btn"),a=document.getElementById("auth-modal"),d=a.querySelector("#login-control"),l=a.querySelector("#password-control"),i=a.querySelector(".login-btn"),m=a.querySelectorAll(".close-btn");l.type="password";const u=()=>{n.classList.add("d-none"),c.classList.remove("d-none"),r.classList.remove("d-none"),s.classList.remove("d-none"),e(a)};n.addEventListener("click",(()=>{t(a)})),m.forEach((t=>{t.addEventListener("click",(()=>{e(a)}))})),i.addEventListener("click",(()=>{const t=d.value,e=l.value,n='<p class="login__error" style="color: red;">Неверный логин</p>',c='<p class="password__error" style="color: red;">Неверный пароль</p>';o("/profile").then((o=>{const r=document.querySelector(".login__error"),s=document.querySelector(".password__error"),a=o.login&&o.login===t,i=o.password&&o.password===e;a&&i?(r&&r.remove(),s&&s.remove(),localStorage.setItem("auth",JSON.stringify(o)),u()):a||i?!a&&i?(!r&&d.insertAdjacentHTML("afterend",n),s&&s.remove()):a&&!i?(!s&&l.insertAdjacentHTML("afterend",c),r&&r.remove()):alert("Введите данные от аккаунта"):(!r&&d.insertAdjacentHTML("afterend",n),!s&&l.insertAdjacentHTML("afterend",c))}))})),r.addEventListener("click",(()=>{localStorage.removeItem("auth"),n.classList.remove("d-none"),c.classList.add("d-none"),r.classList.add("d-none"),s.classList.add("d-none")})),(()=>{const t=JSON.parse(localStorage.getItem("auth"));t&&o("/profile").then((e=>{e.login&&e.login===t.login&&e.password&&e.password===t.password&&u()}))})()})(),(()=>{const t=document.getElementById("products-container"),e=document.querySelector(".catalog-search"),c=e=>{t.innerHTML="",e.forEach((e=>{const n=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB"}).format(e.price);t.insertAdjacentHTML("beforeend",`\n        <div class="col col-12 col-sm-6 col-lg-4 col-xl-3 mb-3">\n          <a href="#" class="card-link">\n            <div class="card">\n              <img src="${e.preview}" class="card-img-top" alt="phone-1">\n              <div class="card-body">\n                <span class="mb-2 d-block text-secondary">${e.title}</span>\n                <h6 class="card-title mb-3">${e.name}</h6>\n\n                <div class="row">\n                  <div class="col d-flex align-itemns-center justify-content-between">\n                    <h4>${n}</h4>\n                    <button type="button" class="btn btn-outline-dark" data-product="${e.id}">\n                      <img src="/images/icon/shopping-cart-big.svg" alt="login">\n                    </button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n      `)}))};e.addEventListener("input",(t=>{const e=t.target,n=window.location.search,r=new URLSearchParams(n).get("id");o(`/products?category=${r}&q=${e.value}`).then((t=>{c(t)})).catch((t=>{console.error("Произошла ошибка")}))})),t.addEventListener("click",(t=>{const e=t.target;if(e.closest("button")){const t=e.closest("button").dataset.product;o(`/products/${t}`).then((t=>{var e;("/cart",e={name:t.name,price:t.price,count:1},fetch(n+"/cart",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((t=>{if(!t.ok)throw new Error;return t.json()}))).then((()=>{console.log("Добавлено")}))})).catch((t=>{console.error("Произошла ошибка")}))}})),(()=>{const t=window.location.search,e=new URLSearchParams(t).get("id");o(e?`/products?category=${e}`:"/products").then((t=>{c(t)})).catch((t=>{console.error("Произошла ошибка")}))})()})(),(()=>{const c=document.getElementById("cart-container"),r=document.getElementById("open-cart-btn"),s=document.getElementById("cart-modal"),a=document.getElementById("cart-total-price"),d=s.querySelectorAll(".close-btn"),l=()=>{o("/cart").then((t=>{(t=>{c.innerHTML="",t.forEach((t=>{const e=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB"}).format(t.price);c.insertAdjacentHTML("beforeend",`\n        <div class="row border-bottom pb-3 pt-3">\n          <div class="col col-12 col-md-6 mb-3 mb-md-0 fs-4">\n            ${t.name}\n          </div>\n          <div class="col col-12 col-md-6 fs-4 d-flex align-items-center justify-content-end flex-wrap">\n            <h4 class="me-3 d-flex align-itemns-center">${e}</h4>\n            <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls" id="control-dec" data-id="${t.id}" data-count="${t.count}">\n              -\n            </button>\n            <h6 class="cart-item-count me-3 ms-3">${t.count}</h6>\n            <button type="button" class="btn btn-outline-dark btn-sm cart-item-controls" id="control-inc" data-id="${t.id}" data-name="${t.name}" data-price="${t.price}" data-count="${t.count}">\n              +\n            </button>\n          </div>\n        </div>\n      `)}))})(t),i(t)})).catch((t=>{console.error("Произошла ошибка")}))},i=t=>{let e=0;t.forEach((t=>{e+=Number(t.price)*t.count}));const n=new Intl.NumberFormat("ru",{style:"currency",currency:"RUB"}).format(e);a.textContent=`${n}`};r.addEventListener("click",(()=>{l(),t(s)})),d.forEach((t=>{t.addEventListener("click",(()=>{e(s)}))})),c.addEventListener("click",(t=>{const e=t.target;if(e.closest("button"))if(e.id&&"control-inc"===e.id){const t=e.dataset.id;(o=`/cart/${t}`,c={id:t,name:e.dataset.name,count:Number(e.dataset.count)+1,price:e.dataset.price},fetch(n+o,{method:"PUT",body:JSON.stringify(c),headers:{"Content-Type":"application/json"}}).then((t=>{if(!t.ok)throw new Error;return t.json()}))).then((()=>{l()}))}else if(e.id&&"control-dec"===e.id){const t=e.dataset.id,o=Number(e.dataset.count);o>0&&((t,e)=>fetch(n+t,{method:"PATCH",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((t=>{if(!t.ok)throw new Error;return t.json()})))(`/cart/${t}`,{count:o-1}).then((()=>{l()}))}var o,c}))})()})();